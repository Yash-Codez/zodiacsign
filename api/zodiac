import { supabase } from './supabaseClient.js';

app.post('/api/zodiac', async (req, res) => {
  const { name, dateOfBirth } = req.body;
  const birthDate = new Date(dateOfBirth);
  const zodiacSign = calculateZodiacSign(birthDate);

  // ‚úÖ Log incoming data
  console.log('üîπ Received POST data:', { name, dateOfBirth, zodiacSign });

  // Save to Supabase
  const { error, data } = await supabase.from('zodiac_entries').insert([{
    name: name.trim(),
    dateofbirth: dateOfBirth,
    zodiac_sign: zodiacSign,
  }]);

  if (error) {
    console.error('‚ùå Supabase insert error:', error);
    return res.status(500).json({ success: false, message: 'Failed to save data' });
  }

  // ‚úÖ Log successful insertion
  console.log('‚úÖ Supabase insert success:', data);

  res.json({
    success: true,
    data: {
      zodiacSign,
      message: `Hello ${name}! Your zodiac sign is ${zodiacSign}.`
    }
  });
});
